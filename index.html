<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:regular,bold' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Coda+Caption:800' rel='stylesheet' type='text/css'>
    <style>
      html, body {
        background: rgb(240, 240, 240);
        font-family: 'Droid Sans', arial, serif;
      }
      h1, h2, h3, h4, h5, h6 {
        text-align: center;
      }
      
      h1 a {
        text-decoration: none;
      }
      
      header, footer {
        display: block;
      }
      
      a {
        color: #222;
      }
      a:hover {
        color: #555;
      }
      
      #container {
        width: 700px;
        margin: 0 auto;
      }
      
      #main {
        display: table;
        width: 100%;
        background: rgb(240, 240, 240);
        overflow: hidden;
      }
      #main canvas {
        margin: 10px;
      }
      #main .playerContainer {
        display: table-cell;
        vertical-align: top;
      }
      #main .choicesContainer {
        display: table-cell;
        vertical-align: middle;
        width: 100%;
      }
      
      ul.choices {
        padding: 0;
        list-style: none;
      }
      .choices li {
        margin: 20px 0;
        border-radius: 10px;
        border: 2px solid black;
        background: white;
        text-align: center;
        font-size: 1.3em;
        font-family: 'Droid Sans', arial, serif;
        font-weight: bold;
      }
      .choices li a {
        padding: 10px;
        display: block;
        text-decoration: none;
        color: #333;
      }
      
      .choices li.like:hover {
        border-color: #3a0;
      }
      .choices li.dislike:hover {
        border-color: #c00;
      }
      
      .choices li.like a:before, 
      .choices li.like a:after {
        content: '\2665';
        margin: 0 10px;
      }
      .choices li.like a:hover {
        color: #3a1;
      }
      .choices li.dislike a:hover {
        color: #c00;
      }
      
      .phonetic {
        font-family: mono;
        font-size: 0.6em;
        opacity: 0.2;
        font-weight: bold;
      }
      
      .description {
        font-style: italic;
        font-size: 0.9em;
        color: #333;
        padding: 10px;
        border: 0px dashed rgba(0,0,0,0.2);
        border-width: 2px 0;
      }
      
      #loading {
        color: #999;
        min-height: 400px;
      }
      
      footer {
        text-align: center;
      }
      
      #main .choices {
        margin: 40px 0;
      }
      
      .share .addthis_toolbox * {
        float: none;
        display: inline-block;
        vertical-align: middle;
      }
      .share .addthis_toolbox strong {
        font-size: 1.2em;
        margin-right: 4px;
      }
      
      .share {
        text-align: center;
      }
      
      .melody-infos a {
        text-decoration: none;
      }
      .melody-infos a:hover {
        text-decoration: underline;
      }
      .melody-infos {
        font-family: 'Coda Caption';
        text-align: center;
        font-size: 1.1em;
        line-height: 1.5em;
      }
      .melody-infos .family {
        color: #000;
      }
      .melody-infos .family:before {
        content: '\266A';
        margin: 2px;
      }
      .melody-infos .id {
        color: #aaa;
      }
      .melody-infos .id:before {
        content: '\266F';
        margin: 2px;
      }
      .melody-infos .generation {
        color: #39E;
      }
      .melody-infos .generation:before {
        content: '\26A4';
        margin: 2px;
      }
      .melody-infos .mutation {
        color: #F66;
      }
      .melody-infos .mutation:before {
        content: '\2622';
        margin: 2px;
      }
    </style>
    <title>♫ Social Melodic</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
    <script type="text/javascript" src="jsfx/audio.js"></script>
    <script type="text/javascript" src="jsfx/jsfx.js"></script>
    <script type="text/javascript" src="melody-utils.js"></script>
    <script type="text/javascript" src="melody-player.js"></script>
    <script type="text/javascript" src="melody-generator.js"></script>
    <script type="text/javascript" src="loader.js"></script>
    <script type="text/javascript" src="processing-1.0.0.min.js"></script>
  </head>
  
  <body>
    <div id="container">
      <h1><a href="/">♫ Social Melodic</a> <span class="phonetic">[səʊʃl̩ mɨˈlɑɾɪk]</span></h1>
      <h2>a human-based melody generator *</h2>
      
      
      <header class="description">
      * People, through their choices, affect the evolution of melodies. 
      Melodies will undergo a series of mutation, 
      and continue to grow and improve themselves over generations. It's called human-based genetic algorithm.
      The more of you, the more changes will be fast and significant.
      </header>
      
      <div id="loading">
        <h2><img src="ajax-loader.gif" /> Loading...</h2> 
      </div>
      
      <div id="main" style="display: none;">
        <section class="choicesContainer">
          <div class="melody-infos">
            <a href="" class="family" title="Family name">Typhon</a>
            <span class="id" title="Melody number">1234</span>
            <span class="generation" title="Generation (number of parents)">3</span>
            <span class="mutation" title="Total of mutation">2</span>
          </div>
          <ul class="choices hidden">
            <li class="like"><a href="#">I like</a></li>
            <li class="dislike"><a href="#">I don't like</a></li>
          </ul>
          <div class="share">
            <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
              <strong>Share this </strong>
              <a class="addthis_button_facebook"></a>
              <a class="addthis_button_twitter"></a>
              <a class="addthis_button_digg"></a>
              <a class="addthis_button_reddit"></a>
            </div>
            <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#username=xa-4d6411c970947c4d"></script>
          </div>
        </section>
        <section class="playerContainer">
          <canvas id="player"></canvas>
        </section>
      </div>
      
      <footer>
        <a href="http://grenlibre.fr/">grenlibre.fr</a> - Gaetan Renaudeau - 2011
      </footer>
      
    </div>
    
    <script type="text/javascript">
$(function(){
  
  // From modernizr
  var canvasSupport = function(){
    var elem = document.createElement( 'canvas' );
    return !!(elem.getContext && elem.getContext('2d'));
  }
  var waveSupport = function(){
    var elem = document.createElement('audio'), bool = !!elem.canPlayType;
    if(bool) return elem.canPlayType('audio/wav; codecs="1"');
  }
  var unsupported = [];
  if(!canvasSupport()) unsupported.push('HTML5 Canvas');
  if(!waveSupport()) unsupported.push('Audio wave format');
  if(unsupported.length) {
    $('#loading').replaceWith("<h2>Your browser doesn't support "+unsupported.join(' and ')+".</h2>");
    return;
  }
  
  if(navigator.userAgent.match('Chrome') && navigator.userAgent.match('Mac')) {
    $('#loading').prepend('<h3>There is an issue on Chrome+Mac with jsfx library. (Noisy sounds..)<br/> If you have the bug, Please go on Safari or Firefox until we fix it.</h3>');
  }
  
  // POC
  new Loader(function(){
    var notes = [];
    var randomJustIntonation = function() {
      var justIntonations = [1,3,5,6,8,10];
      return Math.floor(12*(Math.random()>0.5 ? 0 : 1)+justIntonations[Math.floor(Math.random()*justIntonations.length)])
    }
    for(var i=0; i<32; ++i) {
      var ens = [];
      if( !(i%2==1 && Math.random()>0.2 || i%4==0 && Math.random()>0.8) ) {
        ens.push(randomJustIntonation());
        while(Math.random()>0.85) {
          ens.push(randomJustIntonation());
        }
      }
      notes.push(ens);
    }
    
    var canvas =  document.getElementById('player');
    
    var player = new melody.Player({
      width: 400,
      height: 380,
      bpm: 280,
      nbPitch: 24,
      canvas: canvas,
      melody: {
        notes: notes,
        generator: new melody.Generator([
          ["synth",1,0.4000,0.1000,0.3000,1.3260,0.2240,20.0000,null,2000.0000,0.0000,0.0000,0.0000,18.0063,0.0003,0.0000,0.0000,0.1000,0.0000,0.0000,0.0000,0.0000,0.0000,0.9890,0.0000,0.0000,0.0000,0.0000],
          ["saw",1.0000,0.200,0.0230,0.0600,0.2280,0.3880,20.0000,null,2000.0000,-0.0800,-0.0880,0.0000,18.0542,0.1199,-0.2620,-0.0640,0.0000,0.0855,0.0000,0.0000,0.0500,0.0420,0.7490,0.1400,0.5020,0.3160,-0.4000],
          ["sine",0.0000,0.1,0.0000,0.2580,0.7770,0.5020,20.0000,null,1984.0000,0.0000,0.0000,0.0000,7.9763,0.0003,0.0000,0.0000,0.1000,0.0000,0.0000,0.0000,0.0000,0.0000,1.0000,0.0000,0.0000,0.0000,0.0000]])
      }
    }).load(function(){
      $('#loading').hide();
      $('#main').show(); 
      $('.choices').show();
      player.play();
    });
    
  });
      
});
    </script>
  </body>
</html>
